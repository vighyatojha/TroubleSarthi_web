<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Trouble Sarthi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'SAMAN___';
            src: url('font/SAMAN___.ttf') format('truetype');
            font-weight: normal; font-style: normal; font-display: swap;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1a202c;
            overflow-x: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* ── HEADER ── */
        header, .navbar {
            position: fixed; top: 0; left: 0; right: 0;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(15px);
            z-index: 1000;
            padding: 0.8rem 0;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        nav, .nav-container {
            max-width: 1400px; margin: 0 auto;
            display: flex; justify-content: space-between;
            align-items: center; padding: 0 2rem;
        }
        .logo, .nav-logo {
            font-size: 2.3rem; font-weight: 700; color: #ffffff;
            font-family: 'SAMAN___', sans-serif;
            text-decoration: none; letter-spacing: 0.5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        .nav-logo span { font-family: 'SAMAN___', sans-serif; }
        .nav-center, .nav-links {
            display: flex; list-style: none;
            gap: 2.5rem; flex: 1; justify-content: center;
            align-items: center;
        }
        .nav-center a, .nav-links a {
            text-decoration: none; color: rgba(255,255,255,0.9);
            font-weight: 600; font-size: 1rem;
            position: relative; transition: all 0.3s ease;
        }
        .nav-center a:hover, .nav-links a:hover { color: #ffffff; transform: translateY(-2px); }
        .nav-center a::after, .nav-links a::after {
            content: ''; position: absolute; bottom: -5px; left: 0;
            width: 0; height: 2px;
            background: linear-gradient(135deg, #ffffff, #f0f0f0);
            transition: width 0.3s ease;
        }
        .nav-center a:hover::after, .nav-links a:hover::after { width: 100%; }

        .nav-auth { display: flex; gap: 1rem; align-items: center; position: relative; }

        .auth-btn {
            padding: 0.6rem 1.5rem; border: none; border-radius: 25px;
            font-weight: 700; cursor: pointer; transition: all 0.3s ease;
            text-decoration: none; font-size: 0.9rem;
            display: inline-flex; align-items: center; gap: 0.5rem;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .bookings-btn {
            background: rgba(56,161,105,0.2); color: white;
            border: 2px solid rgba(56,161,105,0.5);
        }
        .bookings-btn:hover {
            background: rgba(56,161,105,0.3); transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(56,161,105,0.3);
        }

        /* ── PROFILE DROPDOWN ── */
        .user-profile { position: relative; display: flex; align-items: center; }
        .profile-dropdown {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white; padding: 0.6rem 1.2rem;
            border-radius: 25px; cursor: pointer;
            display: flex; align-items: center; gap: 0.5rem;
            font-weight: 600; transition: all 0.3s ease; position: relative;
        }
        .profile-dropdown:hover {
            background: rgba(255,255,255,0.25); transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255,255,255,0.2);
        }
        .profile-dropdown.active .fa-chevron-down { transform: rotate(180deg); }
        .fa-chevron-down { transition: transform 0.3s ease; font-size: 0.8rem; }

        .dropdown-menu {
            position: absolute; top: calc(100% + 0.5rem); right: 0;
            background: rgba(255,255,255,0.97);
            backdrop-filter: blur(20px); border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            min-width: 180px; opacity: 0; visibility: hidden;
            transform: translateY(-10px); transition: all 0.3s ease;
            z-index: 1001; border: 1px solid rgba(255,255,255,0.3);
        }
        .dropdown-menu.active { opacity: 1; visibility: visible; transform: translateY(0); }
        .dropdown-menu::before {
            content: ''; position: absolute; top: -6px; right: 20px;
            width: 12px; height: 12px;
            background: rgba(255,255,255,0.97); transform: rotate(45deg);
            border-top: 1px solid rgba(255,255,255,0.3);
            border-left: 1px solid rgba(255,255,255,0.3);
        }
        /* nav-links dropdown for firebase version */
        #profileDropdown {
            position: absolute; top: calc(100% + 0.5rem); right: 0;
            background: rgba(255,255,255,0.97);
            backdrop-filter: blur(20px); border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            min-width: 180px; opacity: 0; visibility: hidden;
            transform: translateY(-10px); transition: all 0.3s ease;
            z-index: 1001;
        }
        #profileDropdown.active { opacity: 1; visibility: visible; transform: translateY(0); }
        .dropdown-item, #profileDropdown a {
            display: flex; align-items: center; gap: 0.8rem;
            padding: 1rem 1.5rem; color: #2d3748;
            text-decoration: none; font-weight: 600; font-size: 0.9rem;
            transition: all 0.3s ease;
            border-bottom: 1px solid rgba(226,232,240,0.5);
        }
        .dropdown-item:last-child, #profileDropdown a:last-child { border-bottom: none; border-radius: 0 0 15px 15px; }
        .dropdown-item:first-child, #profileDropdown a:first-child { border-radius: 15px 15px 0 0; }
        .dropdown-item:hover, #profileDropdown a:hover {
            background: rgba(102,126,234,0.1); color: #667eea; transform: translateX(5px);
        }
        .dropdown-item i, #profileDropdown a i { font-size: 1rem; color: #718096; }
        .dropdown-item:hover i, #profileDropdown a:hover i { color: #667eea; }

        .logout-btn {
            background: none; border: none; width: 100%;
            display: flex; align-items: center; gap: 0.8rem;
            padding: 1rem 1.5rem; color: #e53e3e;
            font-weight: 600; font-size: 0.9rem; cursor: pointer;
            transition: all 0.3s ease; font-family: inherit;
            border-radius: 0 0 15px 15px;
        }
        .logout-btn:hover { background: rgba(229,62,62,0.1); transform: translateX(5px); }
        .logout-btn i { color: #e53e3e; }

        /* ── MOBILE MENU ── */
        .mobile-menu-toggle {
            display: none; background: none; border: none;
            font-size: 1.8rem; cursor: pointer; color: white;
        }
        .mobile-menu {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: rgba(255,255,255,0.1); backdrop-filter: blur(15px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            padding: 2rem 0; border-top: 1px solid rgba(255,255,255,0.1);
        }
        .mobile-menu.active { display: block; animation: slideDown 0.3s ease; }
        .mobile-menu ul { list-style: none; text-align: center; margin-bottom: 1rem; }
        .mobile-menu ul li { margin: 1rem 0; }
        .mobile-menu a { text-decoration: none; color: rgba(255,255,255,0.9); font-weight: 600; }
        .mobile-auth { text-align: center; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }
        .mobile-profile { display: flex; flex-direction: column; gap: 1rem; align-items: center; padding: 1rem; border-top: 1px solid rgba(255,255,255,0.2); margin-top: 1rem; }
        .mobile-username { color: white; font-weight: 600; font-size: 1.1rem; }
        .mobile-profile-actions { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; }

        /* nav-links as mobile menu (firebase version) */
        .nav-links { position: relative; }

        @keyframes slideDown { from { opacity:0; transform:translateY(-20px); } to { opacity:1; transform:translateY(0); } }

        /* ── ALERT ── */
        .alert {
            position: fixed; top: 100px; left: 50%; transform: translateX(-50%);
            padding: 1.2rem 2rem; border-radius: 15px; font-weight: 600;
            display: flex; align-items: center; gap: 0.8rem;
            z-index: 1100; max-width: 500px; min-width: 300px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            animation: slideInDown 0.5s ease; transition: opacity 0.3s, transform 0.3s;
        }
        .alert-success { background: linear-gradient(135deg,#c6f6d5,#9ae6b4); color: #22543d; border: 2px solid #68d391; }
        .alert-error   { background: linear-gradient(135deg,#fed7d7,#feb2b2); color: #742a2a; border: 2px solid #fc8181; }
        @keyframes slideInDown { from { opacity:0; transform:translate(-50%,-30px); } to { opacity:1; transform:translate(-50%,0); } }

        /* ── HERO ── */
        .hero-section, .stats-section:first-of-type {
            padding: 6rem 2rem 0;
            text-align: center;
        }
        .hero-content { max-width: 800px; margin: 0 auto; padding-bottom: 2rem; }
        .hero-content h1 {
            font-size: 3.5rem; font-weight: 900;
            background: linear-gradient(135deg, #fff, #f7fafc);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            margin-bottom: 1rem; letter-spacing: -2px; line-height: 1.2;
            animation: fadeInUp 0.8s ease;
        }
        .hero-content p {
            font-size: 1.3rem; color: rgba(255,255,255,0.8);
            font-weight: 500; animation: fadeInUp 0.8s ease 0.2s both;
        }
        .search-bar, .search-box {
            display: flex; align-items: center; gap: 1rem;
            max-width: 500px; margin: 2rem auto 0;
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.25);
            border-radius: 50px; padding: 0.8rem 1.5rem;
            transition: all 0.3s ease;
        }
        .search-bar:focus-within { background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.5); }
        .search-bar i, .search-box i { color: rgba(255,255,255,0.7); font-size: 1.1rem; }
        .search-bar input, .search-input {
            flex: 1; background: transparent; border: none; outline: none;
            color: white; font-size: 1rem; font-family: inherit;
        }
        .search-bar input::placeholder, .search-input::placeholder { color: rgba(255,255,255,0.6); }

        /* ── STATS ── */
        .stats-section {
            padding: 3rem 0 2rem;
        }
        .stats-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem; margin-bottom: 3rem;
        }
        .stat-card {
            background: rgba(255,255,255,0.15); backdrop-filter: blur(20px);
            border-radius: 20px; padding: 2rem 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease; text-align: center;
            animation: fadeInUp 0.6s ease forwards;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .stat-number { font-size: 3rem; font-weight: 900; color: white; display: block; margin-bottom: 0.5rem; }
        .stat-label { color: rgba(255,255,255,0.8); font-weight: 600; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; }

        /* ── SERVICES SECTION ── */
        .services-section { padding: 2rem 0 6rem; min-height: 80vh; }
        .section-header, .hero-title { text-align: center; margin-bottom: 3rem; }
        .section-header h2, .hero-title h1 {
            font-size: 3rem; font-weight: 900;
            background: linear-gradient(135deg, #fff, #f7fafc);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            margin-bottom: 1rem; letter-spacing: -1px;
            animation: fadeInUp 0.8s ease;
        }
        .section-header p, .hero-title p {
            font-size: 1.2rem; color: rgba(255,255,255,0.8); font-weight: 500;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; }

        .search-filter-section {
            margin-bottom: 3rem; display: flex;
            justify-content: center; gap: 1rem; flex-wrap: wrap;
        }

        /* ── CATEGORIES GRID ── */
        .categories-grid {
            display: grid; grid-template-columns: repeat(2, 1fr);
            gap: 2rem; margin-bottom: 4rem;
            max-width: 1400px; margin-left: auto; margin-right: auto;
            padding: 0 2rem;
        }
        .category-card {
            background: rgba(255,255,255,0.1); backdrop-filter: blur(20px);
            border-radius: 25px; padding: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
            cursor: pointer; position: relative; overflow: hidden;
            animation: fadeInUp 0.6s ease forwards;
        }
        .category-card::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent);
            transition: left 0.5s ease;
        }
        .category-card:hover::before { left: 100%; }
        .category-card:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 25px 50px rgba(0,0,0,0.25); border-color: rgba(255,255,255,0.3); }
        .category-card.expanded { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); }

        .category-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
        .category-info { display: flex; align-items: center; gap: 1rem; }
        .category-icon {
            width: 70px; height: 70px; border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            font-size: 2.2rem; background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px); transition: all 0.3s ease; color: white;
        }
        .category-card:hover .category-icon { transform: scale(1.1) rotate(5deg); }
        .category-details h3 { color: white; font-size: 1.6rem; font-weight: 700; margin-bottom: 0.5rem; }
        .category-details p { color: rgba(255,255,255,0.7); font-size: 0.95rem; }
        .category-meta { display: flex; align-items: center; gap: 1rem; }
        .helper-count {
            background: rgba(255,255,255,0.2); color: white;
            padding: 0.6rem 1.2rem; border-radius: 25px;
            font-size: 0.85rem; font-weight: 600;
            display: flex; align-items: center; gap: 0.5rem;
        }
        .expand-icon { color: white; font-size: 1.5rem; transition: transform 0.4s cubic-bezier(0.4,0,0.2,1); }
        .category-card.expanded .expand-icon { transform: rotate(180deg); }

        /* ── HELPERS LIST ── */
        .helpers-list {
            max-height: 0; overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4,0,0.2,1), opacity 0.3s ease, padding 0.3s ease;
            opacity: 0; padding: 0;
        }
        .helpers-list.expanded { max-height: 2000px; opacity: 1; padding-top: 1rem; }
        .helper-card {
            background: rgba(255,255,255,0.1); border-radius: 20px;
            padding: 1.5rem; margin-bottom: 1rem;
            border: 1px solid rgba(255,255,255,0.15);
            transition: all 0.3s ease;
            animation: slideInHelper 0.5s ease forwards;
            display: flex; flex-direction: column; min-height: 180px;
        }
        .helper-card:nth-child(1){animation-delay:0.1s}.helper-card:nth-child(2){animation-delay:0.2s}.helper-card:nth-child(3){animation-delay:0.3s}.helper-card:nth-child(4){animation-delay:0.4s}
        @keyframes slideInHelper { to { opacity: 1; transform: translateY(0); } }
        .helper-card:hover { background: rgba(255,255,255,0.15); transform: translateX(8px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }

        .helper-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem; flex: 1; }
        .helper-info { flex: 1; min-width: 200px; }
        .helper-info h4 { color: white; font-size: 1.3rem; font-weight: 700; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
        .verified-badge { background: linear-gradient(135deg,#38a169,#48bb78); color: white; font-size: 0.7rem; padding: 0.2rem 0.5rem; border-radius: 10px; font-weight: 600; }
        .helper-info p { color: rgba(255,255,255,0.7); font-size: 0.95rem; line-height: 1.4; margin-bottom: 0.5rem; }
        .helper-rating { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; }
        .stars { color: #ffd700; font-size: 1.1rem; display: flex; gap: 2px; }
        .rating-text { color: rgba(255,255,255,0.8); font-size: 0.9rem; font-weight: 600; }

        .helper-contact { display: flex; justify-content: space-between; align-items: center; margin-top: auto; flex-wrap: wrap; gap: 1rem; padding-top: 1rem; }
        .contact-info { display: flex; gap: 1rem; flex-wrap: wrap; flex: 1; }
        .contact-item { color: rgba(255,255,255,0.8); font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0.8rem; background: rgba(255,255,255,0.1); border-radius: 15px; transition: all 0.3s ease; white-space: nowrap; }
        .contact-item:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); }
        .contact-item i { font-size: 0.9rem; min-width: 12px; text-align: center; }

        .book-btn {
            background: linear-gradient(135deg,#38a169,#48bb78); color: white;
            border: none; padding: 0.8rem 1.8rem; border-radius: 25px;
            font-weight: 700; cursor: pointer; transition: all 0.3s ease;
            font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem;
            text-transform: uppercase; letter-spacing: 0.5px; white-space: nowrap;
        }
        .book-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(56,161,105,0.4); background: linear-gradient(135deg,#2f855a,#38a169); }

        .no-services { text-align: center; padding: 4rem 2rem; color: rgba(255,255,255,0.7); grid-column: 1/-1; }
        .no-services i { font-size: 4rem; margin-bottom: 1.5rem; display: block; }
        .no-services h3 { font-size: 1.8rem; margin-bottom: 1rem; color: white; }

        /* ── BOOKING MODAL ── */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            z-index: 2000; animation: fadeIn 0.3s ease; overflow-y: auto;
        }
        .modal-content, .booking-modal-content {
            background: white; padding: 3rem; border-radius: 25px;
            width: 90%; max-width: 600px; margin: 2% auto;
            position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: slideInUp 0.4s ease; max-height: 95vh; overflow-y: auto;
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-header h2 { color: #2d3748; font-size: 1.8rem; font-weight: 800; }
        .modal-close, .close {
            background: #f7fafc; border: none; font-size: 1.8rem; cursor: pointer;
            color: #999; width: 40px; height: 40px; display: flex; align-items: center;
            justify-content: center; border-radius: 50%; transition: all 0.3s ease;
            position: absolute; top: 1.5rem; right: 2rem;
        }
        .modal-close:hover, .close:hover { color: #667eea; background: #e2e8f0; }
        .modal-body { padding-top: 0; }

        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        @keyframes slideInUp { from{transform:translateY(50px);opacity:0} to{transform:translateY(0);opacity:1} }

        .form-title { font-size: 2.2rem; color: #2d3748; margin-bottom: 1rem; text-align: center; font-weight: 800; }
        .form-subtitle { color: #718096; text-align: center; margin-bottom: 2rem; font-size: 1.1rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #2d3748; font-size: 0.95rem; }
        .required { color: #e53e3e; }
        .form-input, .form-textarea {
            width: 100%; padding: 1rem 1.2rem; border: 2px solid #e2e8f0;
            border-radius: 15px; font-size: 1rem; transition: all 0.3s ease;
            background: #f7fafc; font-family: inherit;
        }
        textarea.form-input, .form-textarea { min-height: 80px; resize: vertical; }
        .form-input:focus, .form-textarea:focus {
            outline: none; border-color: #667eea; background: white;
            box-shadow: 0 0 0 4px rgba(102,126,234,0.1); transform: translateY(-2px);
        }
        .form-input[readonly] { background: #edf2f7; color: #4a5568; }

        /* ── PAYMENT ── */
        .payment-methods { display: grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .payment-method {
            padding: 1.2rem; border: 2px solid #e2e8f0; border-radius: 15px;
            text-align: center; cursor: pointer; transition: all 0.3s ease;
            background: white; font-weight: 600; font-size: 1rem; color: #2d3748;
        }
        .payment-method i { display: block; font-size: 2rem; margin-bottom: 0.5rem; }
        .payment-method:hover { border-color: #667eea; background: #f7fafc; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .payment-method.selected { border-color: #667eea; background: #edf2f7; transform: scale(1.05); box-shadow: 0 10px 25px rgba(102,126,234,0.2); }
        .payment-section { display: none; margin-top: 1rem; padding: 1.5rem; background: #f7fafc; border-radius: 15px; border: 2px solid #e2e8f0; }
        .payment-section.active { display: block; animation: fadeInUp 0.5s ease; }
        .cash-info { background: rgba(56,161,105,0.1); padding: 1.2rem; border-radius: 12px; border: 2px solid rgba(56,161,105,0.3); }
        .cash-info h4 { color: #2f855a; margin-bottom: 0.5rem; }
        .cash-info p { color: #38a169; }

        .submit-btn {
            width: 100%; background: linear-gradient(135deg,#667eea,#764ba2);
            color: white; border: none; padding: 1.3rem 2rem; border-radius: 15px;
            font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center; gap: 0.8rem;
            text-transform: uppercase; letter-spacing: 1px; margin-top: 2rem;
        }
        .submit-btn:hover { background: linear-gradient(135deg,#5a67d8,#6b46c1); transform: translateY(-3px); box-shadow: 0 15px 35px rgba(102,126,234,0.4); }

        /* ── MY BOOKINGS MODAL ── */
        .bookings-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px);
            z-index: 2000; animation: fadeIn 0.3s ease; overflow-y: auto;
        }
        .bookings-content, .bookings-modal-content {
            background: white; padding: 3rem; border-radius: 25px;
            width: 90%; max-width: 900px; margin: 2% auto;
            position: relative; box-shadow: 0 25px 50px rgba(0,0,0,0.3);
            animation: slideInUp 0.4s ease; max-height: 90vh; overflow-y: auto;
        }
        .bookings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #e2e8f0; }
        .bookings-header h2 { font-size: 2rem; color: #2d3748; font-weight: 800; }
        .bookings-header button { background: none; border: none; font-size: 2rem; cursor: pointer; color: #999; transition: color 0.3s; }
        .bookings-header button:hover { color: #667eea; }

        .booking-card {
            background: linear-gradient(135deg,#f7fafc,#edf2f7); padding: 2rem;
            border-radius: 20px; margin-bottom: 1.5rem;
            border-left: 5px solid #667eea; transition: all 0.3s ease;
            position: relative; overflow: hidden;
        }
        .booking-card:hover { transform: translateX(5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); border-left-color: #5a67d8; }
        .booking-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .booking-id { font-weight: 800; color: #2d3748; font-size: 1.3rem; display: flex; align-items: center; gap: 0.5rem; }
        .booking-status { padding: 0.5rem 1.2rem; border-radius: 20px; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .status-pending { background: linear-gradient(135deg,#fed7d7,#feb2b2); color: #c53030; border: 2px solid #fc8181; }
        .status-confirmed { background: linear-gradient(135deg,#c6f6d5,#9ae6b4); color: #2f855a; border: 2px solid #68d391; }
        .status-completed { background: linear-gradient(135deg,#bee3f8,#90cdf4); color: #2b6cb0; border: 2px solid #63b3ed; }
        .booking-details { display: grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap: 1rem; color: #4a5568; }
        .detail-item { display: flex; align-items: center; gap: 0.8rem; padding: 0.8rem 1rem; background: rgba(255,255,255,0.7); border-radius: 12px; transition: all 0.3s ease; }
        .detail-item:hover { background: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .detail-item i { color: #667eea; font-size: 1.1rem; min-width: 16px; text-align: center; }
        .detail-item strong { color: #2d3748; margin-right: 0.3rem; }
        .no-bookings { text-align: center; padding: 4rem 2rem; color: #718096; }
        .no-bookings i { font-size: 4rem; margin-bottom: 1.5rem; display: block; color: #cbd5e0; }
        .no-bookings h3 { font-size: 1.8rem; margin-bottom: 1rem; color: #4a5568; }

        /* ── LOADING ── */
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 9999; display: none; align-items: center; justify-content: center;
        }
        .loading-spinner { text-align: center; color: white; background: white; padding: 2rem 3rem; border-radius: 15px; }
        .loading-spinner i { font-size: 2rem; color: #667eea; }
        .loading-spinner p { margin-top: 1rem; font-weight: 600; color: #2d3748; }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-top: 5px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ── FOOTER ── */
        footer { background: linear-gradient(135deg,#667eea,#764ba2); color: #fff; text-align: center; padding: 2rem; }

        /* ── ANIMATIONS ── */
        @keyframes fadeInUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }

        /* ── RESPONSIVE ── */
        @media (max-width: 768px) {
            .nav-center, .nav-links { display: none; }
            .nav-links.active { display: flex; flex-direction: column; position: absolute; top: 100%; left: 0; right: 0; background: rgba(30,20,60,0.98); padding: 2rem; gap: 1rem; }
            .mobile-menu-toggle { display: block; }
            .hero-content h1 { font-size: 2.5rem; }
            .categories-grid { grid-template-columns: 1fr; gap: 1.5rem; padding: 0 1rem; }
            .form-row { grid-template-columns: 1fr; }
            .modal-content, .booking-modal-content, .bookings-content, .bookings-modal-content { width: 95%; margin: 5% auto; padding: 2rem; }
            .helper-contact { flex-direction: column; align-items: stretch; }
            .book-btn { width: 100%; justify-content: center; }
            .contact-info { justify-content: center; }
            .stats-grid { grid-template-columns: repeat(2,1fr); gap: 1rem; }
            .stat-number { font-size: 2rem; }
            .booking-details { grid-template-columns: 1fr; }
            .payment-methods { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 480px) {
            .hero-content h1 { font-size: 2rem; }
            .category-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
        }
        html { scroll-behavior: smooth; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.5); }
    </style>
</head>
<body>

<!-- Loading overlay -->
<div id="loadingOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:2rem 3rem;border-radius:12px;text-align:center;">
        <i class="fas fa-spinner fa-spin" style="font-size:2rem;color:#667eea;"></i>
        <p style="margin-top:1rem;font-weight:600;">Processing your booking...</p>
    </div>
</div>

<!-- Alert -->
<div id="alertMessage" class="alert" style="display:none;"></div>

<!-- ══ HEADER ══ -->
<header>
    <nav>
        <a href="#" class="logo">Trouble Sarthi</a>
        <ul class="nav-center">
            <li><a href="index.html">Home</a></li>
            <li><a href="#services">Services</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        <div class="nav-auth">
            <button class="auth-btn bookings-btn" onclick="openBookingsModal()">
                <i class="fas fa-calendar-alt"></i> My Bookings
            </button>
            <div class="user-profile">
                <div class="profile-dropdown" onclick="toggleProfileDropdown()">
                    <i class="fas fa-user-circle"></i>
                    <span class="username" id="navUsername">User</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-menu" id="profileDropdown">
                    <a href="#" class="dropdown-item" onclick="openBookingsModal();return false;">
                        <i class="fas fa-history"></i> My Bookings
                    </a>
                    <button class="logout-btn" onclick="doLogout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
    </nav>
    <div class="mobile-menu" id="mobileMenu">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="#services" onclick="closeMobileMenu()">Services</a></li>
            <li><a href="index.html#about">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
        <div class="mobile-auth">
            <button class="auth-btn bookings-btn" onclick="openBookingsModal();closeMobileMenu();">
                <i class="fas fa-calendar-alt"></i> My Bookings
            </button>
        </div>
        <div class="mobile-profile">
            <div class="mobile-username"><i class="fas fa-user-circle"></i> <span id="mobileUsername">User</span></div>
            <div class="mobile-profile-actions">
                <button onclick="doLogout()" class="auth-btn" style="background:rgba(229,62,62,0.2);border:2px solid rgba(229,62,62,0.5);color:white;cursor:pointer;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </div>
</header>

<!-- ══ STATS ══ -->
<section class="stats-section" style="padding-top:6rem;">
    <div class="stats-container">
        <div class="stats-grid">
            <div class="stat-card"><span class="stat-number" id="statHelpers">0</span><span class="stat-label">Active Helpers</span></div>
            <div class="stat-card"><span class="stat-number" id="statCats">0</span><span class="stat-label">Service Categories</span></div>
            <div class="stat-card"><span class="stat-number" id="statRating">0.0</span><span class="stat-label">Average Rating</span></div>
            <div class="stat-card"><span class="stat-number" id="statBookings">0</span><span class="stat-label">My Bookings</span></div>
        </div>
    </div>
</section>

<!-- ══ SERVICES ══ -->
<section class="services-section" id="services">
    <div class="container">
        <div class="hero-title">
            <h1>Professional Services</h1>
            <p>Connect with verified helpers for all your needs</p>
        </div>
        <div class="search-filter-section">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" placeholder="Search services or helpers..." oninput="filterServices(this.value)">
            </div>
        </div>
        <div class="categories-grid" id="categoriesGrid">
            <div class="no-services"><i class="fas fa-spinner fa-spin"></i><h3>Loading services...</h3></div>
        </div>
    </div>
</section>

<!-- ══ BOOKING MODAL ══ -->
<div id="bookingModal" class="modal" style="display:none;">
    <div class="modal-content booking-modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-calendar-check"></i> Book Service</h2>
            <button class="modal-close" onclick="closeBookingModal()">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="modalHelperId">
            <input type="hidden" id="modalHelperRating">
            <input type="hidden" id="modalHelperJobs">
            <input type="hidden" id="modalHelperEmpId">
            <input type="hidden" id="modalHelperImg">
            <div class="form-row">
                <div class="form-group">
                    <label>Helper Name</label>
                    <input type="text" id="helperName" class="form-input" readonly>
                </div>
                <div class="form-group">
                    <label>Service Category</label>
                    <input type="text" id="serviceCategory" class="form-input" readonly>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Your Name *</label>
                    <input type="text" id="customer_name" class="form-input" placeholder="Full name">
                </div>
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" id="customer_phone" class="form-input" placeholder="10-digit number" maxlength="10">
                </div>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="customer_email" class="form-input" placeholder="Your email">
            </div>
            <div class="form-group">
                <label>Service Date & Time *</label>
                <input type="datetime-local" id="service_date" class="form-input">
            </div>
            <div class="form-group">
                <label>Service Address *</label>
                <textarea id="service_address" class="form-input" rows="2" placeholder="Full address where service is needed"></textarea>
            </div>
            <div class="form-group">
                <label>Special Instructions</label>
                <textarea id="special_instructions" class="form-input" rows="2" placeholder="Any special requirements..."></textarea>
            </div>
            <!-- Payment -->
            <div class="form-group">
                <label>Payment Method</label>
                <input type="hidden" id="payment_method" value="cash">
                <div class="payment-methods">
                    <div class="payment-method selected" data-method="cash" onclick="selectPaymentMethod('cash')">
                        <i class="fas fa-money-bill-wave"></i> Cash
                    </div>
                    <div class="payment-method" data-method="upi" onclick="selectPaymentMethod('upi')">
                        <i class="fas fa-mobile-alt"></i> UPI
                    </div>
                </div>
                <div id="cashPayment" class="payment-section active">
                    <p style="color:#666;font-size:0.9rem;margin-top:0.5rem;"><i class="fas fa-info-circle"></i> Pay cash directly to the helper after service.</p>
                </div>
                <div id="upiPayment" class="payment-section">
                    <input type="text" id="upi_transaction_id" class="form-input" placeholder="Enter UPI Transaction ID" style="margin-top:0.5rem;">
                </div>
            </div>
            <button class="submit-btn" onclick="submitBooking()">
                <i class="fas fa-check-circle"></i> Confirm Booking
            </button>
        </div>
    </div>
</div>

<!-- ══ MY BOOKINGS MODAL ══ -->
<div id="bookingsModal" class="bookings-modal" style="display:none;">
    <div class="bookings-modal-content">
        <div class="bookings-header">
            <h2><i class="fas fa-history"></i> My Bookings</h2>
            <button onclick="closeBookingsModal()" style="background:none;border:none;font-size:1.5rem;cursor:pointer;">&times;</button>
        </div>
        <div id="bookingsList"></div>
    </div>
</div>

<footer style="background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;text-align:center;padding:2rem;">
    <p>&copy; 2024 Trouble Sarthi. All rights reserved.</p>
</footer>

<script type="module">
// ─── Firebase SDK ─────────────────────────────────────────────────
import { initializeApp }    from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, doc, getDoc, addDoc,
         query, where, orderBy, limit, serverTimestamp, Timestamp }
                            from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut }
                            from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

// ─── Firebase config ──────────────────────────────────────────────
// ⚠️  PASTE YOUR FIREBASE CONFIG VALUES HERE (same values as login.html)
const firebaseConfig = {
    apiKey:            "AIzaSyAF7fsleQw4FmiBLZQ6JhlQ2lnuQQJnrjk",
    authDomain:        "trouble-sarthi.firebaseapp.com",
    projectId:         "trouble-sarthi",
    storageBucket:     "trouble-sarthi.firebasestorage.app",
    messagingSenderId: "241665118590",
    appId:             "1:241665118590:web:e705c3ca12324b8c25632f"
};
const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

let currentUser     = null;
let currentUserData = null;
let allHelpers      = [];

// ─── Auth guard ───────────────────────────────────────────────────
onAuthStateChanged(auth, async user => {
    if (!user) { window.location.href = 'login.html'; return; }
    try {
        const snap = await getDoc(doc(db,'users',user.uid));
        if (!snap.exists()) { await signOut(auth); window.location.href='login.html'; return; }
        const data = snap.data();
        if (data.role==='admin') { window.location.href='admin.html'; return; }
        currentUser=user; currentUserData=data;
        const display = data.username||data.fullName||'User';
        document.getElementById('navUsername').textContent    = display;
        document.getElementById('mobileUsername').textContent = display;
        document.getElementById('customer_name').value        = data.fullName||'';
        document.getElementById('customer_phone').value       = (data.phone||'').replace('+91','');
        document.getElementById('customer_email').value       = data.email||'';
        const now=new Date(); now.setMinutes(now.getMinutes()-now.getTimezoneOffset());
        document.getElementById('service_date').min = now.toISOString().slice(0,16);
        await loadHelpers();
    } catch(e) { console.error(e); window.location.href='login.html'; }
});

// ─── Load helpers from /helpers ───────────────────────────────────
async function loadHelpers() {
    try {
        const snap = await getDocs(query(collection(db,'helpers'), where('isAvailable','==',true)));
        allHelpers = snap.docs.map(d=>({id:d.id,...d.data()}));
        allHelpers.sort((a,b) => {
            const ca=(a.serviceType||'').toLowerCase(), cb=(b.serviceType||'').toLowerCase();
            if(ca<cb) return -1; if(ca>cb) return 1;
            if((b.rating||0)!==(a.rating||0)) return (b.rating||0)-(a.rating||0);
            return (a.name||'').localeCompare(b.name||'');
        });
        const byCat={};
        allHelpers.forEach(h=>{ const c=h.serviceType||'Other'; if(!byCat[c]) byCat[c]=[]; byCat[c].push(h); });
        renderCategories(byCat);
        updateStats(byCat);
    } catch(e) {
        document.getElementById('categoriesGrid').innerHTML=
            '<div class="no-services"><i class="fas fa-tools"></i><h3>No services available</h3><p>Please check back later.</p></div>';
    }
}

async function updateStats(byCat) {
    const total=allHelpers.length;
    document.getElementById('statHelpers').textContent = total;
    document.getElementById('statCats').textContent    = Object.keys(byCat).length;
    document.getElementById('statRating').textContent  = total
        ? (allHelpers.reduce((s,h)=>s+(parseFloat(h.rating)||0),0)/total).toFixed(1) : '0.0';
    try {
        const bs = await getDocs(query(collection(db,'bookings'),where('userId','==',currentUser.uid)));
        document.getElementById('statBookings').textContent = bs.size;
    } catch {}
}

// ─── Render ───────────────────────────────────────────────────────
const ICONS = {'cleaning':'fa-broom','plumbing':'fa-wrench','electrical':'fa-bolt',
    'painting':'fa-paint-brush','carpentry':'fa-hammer','gardening':'fa-seedling',
    'tutoring':'fa-book','cooking':'fa-utensils','repair':'fa-tools',
    'home repairs':'fa-home','beauty':'fa-spa','fitness':'fa-dumbbell',
    'pet care':'fa-dog','moving':'fa-truck','it support':'fa-laptop','photography':'fa-camera'};
const getIcon  = c => `<i class="fas ${ICONS[c.toLowerCase()]||'fa-tools'}"></i>`;
const esc      = s => String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const escAttr  = s => String(s).replace(/'/g,"\\'");
const ucwords  = s => s.replace(/\b\w/g,c=>c.toUpperCase());
const cap      = s => String(s).charAt(0).toUpperCase()+String(s).slice(1);

function renderStars(r) {
    let s='';
    for(let i=1;i<=5;i++) {
        if(i<=r) s+='<i class="fas fa-star"></i>';
        else if(i-0.5<=r) s+='<i class="fas fa-star-half-alt"></i>';
        else s+='<i class="far fa-star"></i>';
    }
    return s;
}

function renderCategories(byCat) {
    const grid=document.getElementById('categoriesGrid');
    const cats=Object.keys(byCat);
    if(!cats.length) { grid.innerHTML='<div class="no-services"><i class="fas fa-tools"></i><h3>No services available</h3></div>'; return; }
    grid.innerHTML = cats.map(cat => {
        const helpers=byCat[cat];
        return `<div class="category-card">
            <div class="category-header" onclick="toggleCategory(this)">
                <div class="category-info">
                    <div class="category-icon">${getIcon(cat)}</div>
                    <div class="category-details">
                        <h3>${ucwords(cat)}</h3>
                        <p>Professional ${cat.toLowerCase()} services</p>
                    </div>
                </div>
                <div class="category-meta">
                    <div class="helper-count"><i class="fas fa-users"></i> ${helpers.length} Helper${helpers.length!==1?'s':''}</div>
                    <i class="fas fa-chevron-down expand-icon"></i>
                </div>
            </div>
            <div class="helpers-list">
                ${helpers.map(h=>`
                <div class="helper-card" data-helper-name="${(h.name||'').toLowerCase()}">
                    <div class="helper-header">
                        <div class="helper-info">
                            <h4>${esc(h.name||'')} <span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span></h4>
                            <p>${esc(h.experience||'')}${h.pricePerHour?' · ₹'+h.pricePerHour+'/hr':''}</p>
                            <div class="helper-rating">
                                <div class="stars">${renderStars(parseFloat(h.rating)||0)}</div>
                                <span class="rating-text">${parseFloat(h.rating||0).toFixed(1)} · ${h.completedJobs||0} jobs</span>
                            </div>
                        </div>
                    </div>
                    <div class="helper-contact">
                        <div class="contact-info">
                            <div class="contact-item"><i class="fas fa-phone"></i><span>${esc(h.phoneNumber||'')}</span></div>
                            <div class="contact-item"><i class="fas fa-map-marker-alt"></i><span>${esc(h.location||'City Wide')}</span></div>
                            ${h.employeeId?`<div class="contact-item"><i class="fas fa-id-badge"></i><span>${esc(h.employeeId)}</span></div>`:''}
                        </div>
                        <button class="book-btn" onclick="openBookingModal('${h.id}','${escAttr(h.name||'')}','${escAttr(h.serviceType||'')}',${parseFloat(h.rating||0)},${h.completedJobs||0},'${escAttr(h.employeeId||'')}','${escAttr(h.profileImageUrl||'')}')">
                            <i class="fas fa-calendar-check"></i> Book Now
                        </button>
                    </div>
                </div>`).join('')}
            </div>
        </div>`;
    }).join('');
}

// ─── Submit booking ───────────────────────────────────────────────
window.submitBooking = async () => {
    const helperId    = document.getElementById('modalHelperId').value;
    const helperName  = document.getElementById('helperName').value;
    const serviceType = document.getElementById('serviceCategory').value;
    const helperRating   = parseFloat(document.getElementById('modalHelperRating').value||0);
    const helperJobCount = parseInt(document.getElementById('modalHelperJobs').value||0);
    const helperEmpId    = document.getElementById('modalHelperEmpId').value;
    const helperImg      = document.getElementById('modalHelperImg').value;
    const custName  = document.getElementById('customer_name').value.trim();
    const custPhone = document.getElementById('customer_phone').value.trim();
    const custEmail = document.getElementById('customer_email').value.trim();
    const svcDate   = document.getElementById('service_date').value;
    const svcAddr   = document.getElementById('service_address').value.trim();
    const specInstr = document.getElementById('special_instructions').value.trim();
    const payMethod = document.getElementById('payment_method').value;

    if (!custName||!custPhone||!svcDate||!svcAddr) { alert('Please fill all required fields.'); return; }
    if (!/^\d{10}$/.test(custPhone.replace(/\D/g,''))) { alert('Please enter a valid 10-digit phone number.'); return; }
    if (new Date(svcDate)<=new Date()) { alert('Please select a future date and time.'); return; }

    let payStatus='pending', transId=null;
    if (payMethod==='upi') {
        transId=document.getElementById('upi_transaction_id').value.trim();
        if (!transId) { alert('Please enter the UPI Transaction ID.'); return; }
        payStatus='paid';
    }

    const helper=allHelpers.find(h=>h.id===helperId);
    if (!helper) { alert('This helper is no longer available.'); return; }

    document.getElementById('loadingOverlay').style.display='flex';
    try {
        const ref = await addDoc(collection(db,'bookings'), {
            userId:helperId, helperId, helperName,
            helperRating, helperJobCount,
            helperEmployeeId:helperEmpId||null, helperImageUrl:helperImg||null,
            serviceName:ucwords(serviceType),
            serviceId:serviceType.toLowerCase().replace(/\s+/g,'_'),
            status:'pending', address:svcAddr,
            scheduledAt:Timestamp.fromDate(new Date(svcDate)),
            completedAt:null, totalAmount:helper.pricePerHour||null,
            paymentMode:payMethod, paymentStatus:payStatus,
            customerPhone:`+91${custPhone.replace(/\D/g,'')}`,
            customerEmail:custEmail||null,
            specialInstructions:specInstr||null,
            transactionId:transId||null,
            userId:currentUser.uid,
            createdAt:serverTimestamp()
        });
        document.getElementById('loadingOverlay').style.display='none';
        closeBookingModal();
        showAlert(`✅ Booking confirmed! ID: #${ref.id.slice(0,8)}. We'll contact you soon.`,'success');
    } catch(e) {
        document.getElementById('loadingOverlay').style.display='none';
        showAlert('Booking failed: '+e.message,'error');
    }
};

// ─── Load user bookings ───────────────────────────────────────────
async function loadUserBookings() {
    const list=document.getElementById('bookingsList');
    list.innerHTML='<div class="no-bookings"><i class="fas fa-spinner fa-spin"></i><h3>Loading...</h3></div>';
    try {
        const snap=await getDocs(query(collection(db,'bookings'),where('userId','==',currentUser.uid),orderBy('createdAt','desc'),limit(10)));
        if (snap.empty) { list.innerHTML='<div class="no-bookings"><i class="fas fa-calendar-times"></i><h3>No bookings yet</h3></div>'; return; }
        list.innerHTML=snap.docs.map(d=>{
            const b={id:d.id,...d.data()};
            const dt=b.scheduledAt?.toDate?b.scheduledAt.toDate().toLocaleString('en-IN',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}):'N/A';
            return `<div class="booking-card">
                <div class="booking-header">
                    <div class="booking-id"><i class="fas fa-receipt"></i> #${b.id.slice(0,8)}</div>
                    <div class="booking-status status-${(b.status||'pending').toLowerCase()}">${cap(b.status||'pending')}</div>
                </div>
                <div class="booking-details">
                    <div class="detail-item"><i class="fas fa-user-tie"></i><span><strong>Helper:</strong> ${esc(b.helperName||'N/A')}</span></div>
                    <div class="detail-item"><i class="fas fa-tools"></i><span><strong>Service:</strong> ${esc(b.serviceName||'')}</span></div>
                    <div class="detail-item"><i class="fas fa-calendar"></i><span><strong>Scheduled:</strong> ${dt}</span></div>
                    <div class="detail-item"><i class="fas fa-map-marker-alt"></i><span><strong>Address:</strong> ${esc(b.address||'')}</span></div>
                    <div class="detail-item"><i class="fas fa-credit-card"></i><span><strong>Payment:</strong> ${cap(b.paymentMode||'cash')} — ${cap(b.paymentStatus||'pending')}</span></div>
                </div>
            </div>`;
        }).join('');
    } catch(e) {
        list.innerHTML='<div class="no-bookings"><i class="fas fa-exclamation-triangle"></i><h3>Could not load bookings</h3></div>';
    }
}

// ─── Public window functions (all reachable from onclick="") ──────
window.doLogout = async () => { await signOut(auth); window.location.href='login.html'; };

window.openBookingsModal = () => {
    document.getElementById('bookingsModal').style.display='block';
    document.body.style.overflow='hidden';
    loadUserBookings();
};
window.closeBookingsModal = () => {
    document.getElementById('bookingsModal').style.display='none';
    document.body.style.overflow='auto';
};

window.filterServices = term => {
    document.querySelectorAll('.category-card').forEach(card => {
        const cn=card.querySelector('h3').textContent.toLowerCase(), t=term.toLowerCase().trim();
        let vis=0;
        card.querySelectorAll('.helper-card').forEach(hc => {
            const m=!t||hc.dataset.helperName.includes(t)||hc.textContent.toLowerCase().includes(t);
            hc.style.display=m?'flex':'none'; if(m) vis++;
        });
        card.style.display=(!t||cn.includes(t)||vis>0)?'block':'none';
    });
};

window.toggleMobileMenu = () => {
    const m=document.getElementById('mobileMenu'), i=document.querySelector('.mobile-menu-toggle i');
    const open=m.classList.toggle('active');
    i&&(open?i.classList.replace('fa-bars','fa-times'):i.classList.replace('fa-times','fa-bars'));
};
window.closeMobileMenu = () => {
    document.getElementById('mobileMenu')?.classList.remove('active');
    const i=document.querySelector('.mobile-menu-toggle i');
    i&&i.classList.replace('fa-times','fa-bars');
};

window.toggleProfileDropdown = () => {
    document.getElementById('profileDropdown')?.classList.toggle('active');
    document.querySelector('.user-profile')?.classList.toggle('active');
};

window.toggleCategory = header => {
    const card=header.closest('.category-card'), list=card.querySelector('.helpers-list');
    const was=card.classList.contains('expanded');
    document.querySelectorAll('.category-card').forEach(c => {
        c.classList.remove('expanded'); c.querySelector('.helpers-list').classList.remove('expanded');
    });
    if(!was) { card.classList.add('expanded'); list.classList.add('expanded'); }
};

window.openBookingModal = (helperId,helperName,svcCat,rating,jobs,empId,img) => {
    document.getElementById('modalHelperId').value     = helperId;
    document.getElementById('modalHelperRating').value = rating||0;
    document.getElementById('modalHelperJobs').value   = jobs||0;
    document.getElementById('modalHelperEmpId').value  = empId||'';
    document.getElementById('modalHelperImg').value    = img||'';
    document.getElementById('helperName').value        = helperName;
    document.getElementById('serviceCategory').value   = svcCat;
    selectPaymentMethod('cash');
    document.getElementById('bookingModal').style.display='block';
    document.body.style.overflow='hidden';
};
window.closeBookingModal = () => {
    document.getElementById('bookingModal').style.display='none';
    document.body.style.overflow='auto';
};

window.selectPaymentMethod = method => {
    document.getElementById('payment_method').value=method;
    document.querySelectorAll('.payment-method').forEach(p=>p.classList.remove('selected'));
    document.querySelector(`.payment-method[data-method="${method}"]`)?.classList.add('selected');
    document.querySelectorAll('.payment-section').forEach(s=>s.classList.remove('active'));
    document.getElementById(`${method}Payment`)?.classList.add('active');
};

// Close modals on backdrop click
document.addEventListener('click', e => {
    if (e.target.id==='bookingModal')  { closeBookingModal(); }
    if (e.target.id==='bookingsModal') { closeBookingsModal(); }
    if (!e.target.closest('.user-profile')) {
        document.getElementById('profileDropdown')?.classList.remove('active');
        document.querySelector('.user-profile')?.classList.remove('active');
    }
});

// Phone input — digits only
document.getElementById('customer_phone').addEventListener('input', function() {
    this.value=this.value.replace(/\D/g,'');
    if(this.value.length>10) this.value=this.value.slice(0,10);
});

function showAlert(msg,type) {
    const el=document.getElementById('alertMessage');
    el.className=`alert alert-${type}`;
    el.innerHTML=`<i class="fas fa-${type==='success'?'check-circle':'exclamation-triangle'}"></i> ${msg}`;
    el.style.display='flex';
    setTimeout(()=>{ el.style.opacity='0'; el.style.transform='translate(-50%,-30px)';
        setTimeout(()=>{ el.style.display='none'; el.style.opacity='1'; el.style.transform='translate(-50%,0)'; },300); },5000);
}
</script>

</body>
</html>